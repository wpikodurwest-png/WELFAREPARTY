<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welfare Party AI Strategic Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .dashboard-header { background: linear-gradient(135deg, #001e3c 0%, #003366 100%); }
        .progress-bar-fill { background: linear-gradient(90deg, #facc15 0%, #fb923c 50%, #ef4444 100%); transition: width 1s ease-in-out; }
        .ai-status-box { font-size: 0.78rem; line-height: 1.5; border-radius: 12px; padding: 12px; border-left: 6px solid; }
        .zero-perf { border-color: #dc2626; background-color: #fff1f2; color: #991b1b; }
        .success-perf { border-color: #166534; background-color: #f0fdf4; color: #14532d; }
        .warning-perf { border-color: #f59e0b; background-color: #fffbeb; color: #78350f; }
        .glow-red { animation: criticalPulse 2s infinite; }
        @keyframes criticalPulse { 0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); } 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); } }
    </style>
</head>
<body class="bg-gray-50 font-sans leading-normal">
  

    <header class="dashboard-header text-white p-5 text-center shadow-xl sticky top-0 z-50">
        <h1 class="text-xl md:text-2xl font-black uppercase tracking-widest">Welfare Party Malappuram MANDALAM COLLECTION - 2026</h1>
        <div id="countdown-timer" class="text-[10px] mt-1 font-bold bg-white/20 inline-block px-4 py-1 rounded-full text-white uppercase italic tracking-widest"></div>
    </header>

    <main class="p-2 md:p-8 max-w-7xl mx-auto space-y-6">
        
        <div class="bg-white p-6 rounded-3xl shadow-lg border-t-8 border-blue-900 transition-all">
            <div id="stats-title" class="text-[10px] font-black uppercase text-blue-900 mb-2 tracking-widest">‡¥Æ‡µä‡¥§‡µç‡¥§‡¥§‡µç‡¥§‡¥ø‡¥≤‡µÅ‡¥≥‡µç‡¥≥ ‡¥™‡µÅ‡¥∞‡µã‡¥ó‡¥§‡¥ø</div>
            <div class="flex justify-between items-end mb-4">
                <div>
                    <p class="text-gray-400 text-[9px] font-bold uppercase tracking-widest">COLLECTED</p>
                    <h2 id="total-collected" class="text-4xl md:text-6xl font-black text-blue-900 tracking-tighter">‚Çπ 0</h2>
                </div>
                <div class="text-right">
                    <p class="text-gray-400 text-[9px] font-bold uppercase tracking-widest">TARGET</p>
                    <h2 id="total-target" class="text-xl md:text-2xl font-bold text-gray-600 tracking-tight">‚Çπ 0</h2>
                </div>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-5 overflow-hidden shadow-inner border">
                <div id="main-progress" class="progress-bar-fill h-full" style="width: 0%"></div>
            </div>
        </div>

        <div id="ranking-container" class="grid grid-cols-3 gap-2"></div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-white p-5 rounded-3xl shadow-md border border-gray-200">
                <label class="block text-[10px] font-black text-blue-900 uppercase mb-2 tracking-widest">Panchayath /Munsipality</label>
                <select id="pan-filter" onchange="updateUI()" class="w-full bg-gray-50 p-3 rounded-2xl font-black text-lg outline-none text-blue-900 border-none shadow-inner cursor-pointer">
                    <option value="all">All</option>
                </select>
            </div>
            <div class="bg-white p-5 rounded-3xl shadow-md border border-gray-200">
                <label class="block text-[10px] font-black text-blue-900 uppercase mb-2 tracking-widest">Sorting</label>
                <select id="sort-filter" onchange="updateUI()" class="w-full bg-gray-50 p-3 rounded-2xl font-black text-lg outline-none text-blue-900 border-none shadow-inner cursor-pointer">
                    <option value="percent">Target(%)</option>
                    <option value="amount">Amount (‚Çπ)</option>
                </select>
            </div>
        </div>

        <div id="achiever-container" class="hidden bg-green-50 p-6 rounded-3xl shadow-lg border-2 border-green-200">
            <h3 class="font-black text-green-800 uppercase text-[10px] mb-3 flex items-center gap-2 tracking-widest">
                üèÜ ‡¥≤‡¥ï‡µç‡¥∑‡µç‡¥Ø‡¥Ç ‡¥™‡µÇ‡µº‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥æ‡¥ï‡µç‡¥ï‡¥ø‡¥Ø‡¥µ‡µº (‡¥µ‡¥ø‡¥ú‡¥Ø‡¥ó‡¥æ‡¥•‡¥ï‡µæ)
            </h3>
            <div id="achiever-ai-content" class="text-sm md:text-base text-green-900 italic leading-relaxed font-medium"></div>
        </div>

        <div class="bg-white p-6 rounded-3xl shadow-xl border-l-8 border-blue-900 relative overflow-hidden">
            <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl italic font-black">AI</div>
            <h3 class="font-black text-blue-900 uppercase text-[10px] mb-3 flex items-center gap-2">
                ü§ñ Gemini Dynamic Global Analysis
            </h3>
            <div id="ai-dynamic-content" class="text-sm md:text-base leading-relaxed text-gray-800 italic">
                ‡¥µ‡¥ø‡¥∂‡¥ï‡¥≤‡¥®‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ...
            </div>
        </div>

        <div id="zero-container" class="hidden bg-red-600 p-5 rounded-3xl shadow-xl glow-red">
            <p class="text-white font-black text-[10px] uppercase mb-3 flex items-center gap-2 tracking-widest">
                üö® ‡¥Ö‡¥ü‡¥ø‡¥Ø‡¥®‡µç‡¥§‡¥∞ ‡¥∂‡µç‡¥∞‡¥¶‡µç‡¥ß‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µç: ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥®‡¥Ç ‡¥§‡µÅ‡¥ü‡¥ô‡µç‡¥ô‡¥æ‡¥§‡µç‡¥§ ‡¥Ø‡µÇ‡¥£‡¥ø‡¥±‡µç‡¥±‡µÅ‡¥ï‡µæ
            </p>
            <div id="zero-badge-list" class="flex flex-wrap gap-2"></div>
        </div>

        <div class="bg-white p-4 rounded-3xl shadow-md border border-gray-200 h-72 md:h-96">
            <canvas id="performanceChart"></canvas>
        </div>

        <div class="bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-200">
            <div class="bg-gray-900 text-white p-4 font-black text-center uppercase text-xs tracking-widest">‡¥Ø‡µÇ‡¥£‡¥ø‡¥±‡µç‡¥±‡µç ‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µÅ‡¥ï‡µæ</div>
            <div id="unit-list-container" class="divide-y divide-gray-100"></div>
        </div>

    </main>

    <script>
        const TARGET_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTb39w593ytTuXMolBvhPju9GBVFwPtpO80gzI-F8PSWhpVT0bGfm6KYFi3arIDmrqktmmhkfNg0We4/pub?gid=1934154804&single=true&output=csv';
        const DAILY_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTb39w593ytTuXMolBvhPju9GBVFwPtpO80gzI-F8PSWhpVT0bGfm6KYFi3arIDmrqktmmhkfNg0We4/pub?gid=311568616&single=true&output=csv';

        const PANCHAYAT_MAP = {
            "‡¥Ü‡¥Æ‡¥ï‡µç‡¥ï‡¥æ‡¥ü‡µç": "‡¥Ü‡¥®‡¥ï‡µç‡¥ï‡¥Ø‡¥Ç", "‡¥á‡¥∞‡µÅ‡¥Æ‡µç‡¥™‡µÅ‡¥¥‡¥ø": "‡¥Ü‡¥®‡¥ï‡µç‡¥ï‡¥Ø‡¥Ç", "‡¥™‡¥®‡µç‡¥§‡¥≤‡µç‡¥≤‡µÇ‡µº": "‡¥Ü‡¥®‡¥ï‡µç‡¥ï‡¥Ø‡¥Ç", "‡¥™‡¥æ‡¥™‡µç‡¥™‡¥ø‡¥®‡¥ø‡¥™‡µç‡¥™‡¥æ‡¥±": "‡¥Ü‡¥®‡¥ï‡µç‡¥ï‡¥Ø‡¥Ç", "‡¥™‡µÜ‡¥∞‡¥ø‡¥Æ‡µç‡¥™‡¥≤‡¥Ç": "‡¥Ü‡¥®‡¥ï‡µç‡¥ï‡¥Ø‡¥Ç",
            "‡¥â‡¥Æ‡µç‡¥Æ‡¥§‡µç‡¥§‡µÇ‡µº": "‡¥ï‡µã‡¥°‡µÇ‡µº", "‡¥ï‡¥∞‡µÄ‡¥™‡¥±‡¥Æ‡µç‡¥™": "‡¥ï‡µã‡¥°‡µÇ‡µº", "‡¥ï‡µã‡¥°‡µÇ‡µº": "‡¥ï‡µã‡¥°‡µÇ‡µº", "‡¥§‡¥æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µΩ": "‡¥ï‡µã‡¥°‡µÇ‡µº", "‡¥Æ‡¥ô‡µç‡¥ô‡¥æ‡¥ü‡µç‡¥ü‡µÅ‡¥™‡µÅ‡¥≤‡¥Ç": "‡¥ï‡µã‡¥°‡µÇ‡µº", "‡¥µ‡¥ü‡¥ï‡µç‡¥ï‡µÜ‡¥Æ‡¥£‡µç‡¥£": "‡¥ï‡µã‡¥°‡µÇ‡µº", "‡¥µ‡¥≤‡¥ø‡¥Ø‡¥æ‡¥ü‡µç": "‡¥ï‡µã‡¥°‡µÇ‡µº", "‡¥ö‡µã‡¥≤‡¥ï‡µç‡¥ï‡µΩ": "‡¥ï‡µã‡¥°‡µÇ‡µº",
            "‡¥ö‡µÜ‡¥±‡µÅ‡¥™‡µÅ‡¥§‡µç‡¥§‡µÇ‡µº": "‡¥™‡µÅ‡µΩ‡¥™‡µç‡¥™‡¥±‡µç‡¥±", "‡¥§‡µÉ‡¥™‡µç‡¥™‡¥®‡¥ö‡µç‡¥ö‡¥ø": "‡¥™‡µÅ‡µΩ‡¥™‡µç‡¥™‡¥±‡µç‡¥±", "‡¥Ö‡¥§‡µç‡¥§‡¥æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µΩ": "‡¥™‡µÇ‡¥ï‡µç‡¥ï‡µã‡¥ü‡µç‡¥ü‡µÇ‡µº",
            "‡¥Ö‡¥±‡¥µ‡¥ô‡µç‡¥ï‡¥∞": "‡¥™‡µÇ‡¥ï‡µç‡¥ï‡µã‡¥ü‡µç‡¥ü‡µÇ‡µº", "‡¥™‡µÇ‡¥ï‡µç‡¥ï‡µã‡¥ü‡µç‡¥ü‡µÇ‡µº ‡¥™‡¥≥‡µç‡¥≥‡¥ø‡¥Æ‡µÅ‡¥ï‡µç‡¥ï‡µç": "‡¥™‡µÇ‡¥ï‡µç‡¥ï‡µã‡¥ü‡µç‡¥ü‡µÇ‡µº", "‡¥™‡µÇ‡¥ï‡µç‡¥ï‡µã‡¥ü‡µç‡¥ü‡µÇ‡µº ‡¥≤‡¥ï‡µç‡¥∑‡¥Ç ‡¥µ‡µÄ‡¥ü‡µç": "‡¥™‡µÇ‡¥ï‡µç‡¥ï‡µã‡¥ü‡µç‡¥ü‡µÇ‡µº", "‡¥Æ‡µÅ‡¥£‡µç‡¥ü‡¥ø‡¥§‡µä‡¥ü‡¥ø‡¥ï": "‡¥™‡µÇ‡¥ï‡µç‡¥ï‡µã‡¥ü‡µç‡¥ü‡µÇ‡µº", "‡¥µ‡¥≥‡µç‡¥≥‡µÅ‡¥µ‡¥Æ‡µç‡¥™‡µç‡¥∞‡¥Ç": "‡¥™‡µÇ‡¥ï‡µç‡¥ï‡µã‡¥ü‡µç‡¥ü‡µÇ‡µº", "‡¥Æ‡µá‡¥≤‡µá‡¥Æ‡µÅ‡¥ï‡µç‡¥ï‡µç": "‡¥™‡µÇ‡¥ï‡µç‡¥ï‡µã‡¥ü‡µç‡¥ü‡µÇ‡µº", "‡¥π‡¥æ‡¥´‡µç ‡¥µ‡¥≥‡µç‡¥≥‡µÅ‡¥µ‡¥Æ‡µç‡¥™‡µç‡¥∞‡¥Ç": "‡¥™‡µÇ‡¥ï‡µç‡¥ï‡µã‡¥ü‡µç‡¥ü‡µÇ‡µº",
            "‡¥á‡¥§‡µç‡¥§‡¥ø‡µæ‡¥™‡¥±‡¥Æ‡µç‡¥™‡µç": "‡¥Æ‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥±‡¥Ç", "‡¥ï‡¥æ‡¥≥‡¥Æ‡µç‡¥™‡¥æ‡¥ü‡¥ø": "‡¥Æ‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥±‡¥Ç","‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ‡¥Æ‡µç‡¥Æ‡µΩ": "‡¥Æ‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥±‡¥Ç", "‡¥ï‡µã‡¥ü‡µç‡¥ü‡¥™‡µç‡¥™‡¥ü‡¥ø": "‡¥Æ‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥±‡¥Ç","‡¥ö‡µÄ‡¥®‡¥ø‡¥§‡µç‡¥§‡µã‡¥ü‡µç": "‡¥Æ‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥±‡¥Ç", "‡¥™‡¥ü‡µç‡¥ü‡µº‡¥ï‡¥ü‡¥µ‡µç": "‡¥Æ‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥±‡¥Ç", "‡¥™‡µà‡¥§‡µç‡¥§‡¥ø‡¥®‡¥ø‡¥™‡¥±‡¥Æ‡µç‡¥™‡µç‚Äå": "‡¥Æ‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥±‡¥Ç", "‡¥Æ‡µÅ‡¥£‡µç‡¥ü‡µÅ‡¥™‡¥±‡¥Æ‡µç‡¥™‡µç": "‡¥Æ‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥±‡¥Ç", "‡¥Ö‡¥§‡¥ø‡¥ï‡¥æ‡¥∞‡¥§‡µç‡¥§‡µä‡¥ü‡¥ø(‡¥Æ‡µá‡µΩ‡¥Æ‡µÅ‡¥±‡¥ø)": "‡¥Æ‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥±‡¥Ç", "‡¥Æ‡µà‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥±‡¥Ç" : "‡¥Æ‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥±‡¥Ç", "‡¥µ‡¥≤‡¥ø‡¥Ø‡¥ô‡µç‡¥ô‡¥æ‡¥ü‡¥ø": "‡¥Æ‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥±‡¥Ç", "‡¥π‡¥æ‡¥ú‡¥ø‡¥Ø‡¥æ‡µº ‡¥™‡¥≥‡µç‡¥≥‡¥ø": "‡¥Æ‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥±‡¥Ç",
            "‡¥Æ‡µä‡¥±‡¥Ø‡µÇ‡µº": "‡¥Æ‡µä‡¥±‡¥Ø‡µÇ‡µº", "‡¥Æ‡µã‡¥ô‡µç‡¥ô‡¥Ç": "‡¥Æ‡µä‡¥±‡¥Ø‡µÇ‡µº", "‡¥µ‡¥æ‡¥≤‡¥û‡µç‡¥ö‡µá‡¥∞‡¥ø": "‡¥Æ‡µä‡¥±‡¥Ø‡µÇ‡µº", "‡¥Ö‡¥∞‡¥ø‡¥Æ‡µç‡¥™‡µç‡¥∞": "‡¥Æ‡µä‡¥±‡¥Ø‡µÇ‡µº", "‡¥í‡¥¥‡µÅ‡¥ï‡µÇ‡µº": "‡¥Æ‡µä‡¥±‡¥Ø‡µÇ‡µº"
        };

        let rawUnits = {};
        let myChart = null;

        document.addEventListener('DOMContentLoaded', fetchData);

        async function fetchData() {
            try {
                const [targetRes, dailyRes] = await Promise.all([ fetch(TARGET_SHEET_URL), fetch(DAILY_SHEET_URL) ]);
                const targetRows = (await targetRes.text()).split('\n').slice(1);
                const dailyRows = (await dailyRes.text()).split('\n').slice(1);

                let units = {};
                let uniquePanchayats = new Set();

                targetRows.forEach(row => {
                    const cols = row.split(',').map(c => c.trim());
                    if (!cols[0]) return;
                    units[cols[0]] = { name: cols[0], target: parseFloat(cols[1]) || 0, coll: 0, squads: 0, houses: 0, panchayath: PANCHAYAT_MAP[cols[0]] || "Other" };
                    uniquePanchayats.add(units[cols[0]].panchayath);
                });

                dailyRows.forEach(row => {
                    const cols = row.split(',').map(c => c.trim());
                    if (units[cols[0]]) {
                        units[cols[0]].coll += parseFloat(cols[1]) || 0;
                        units[cols[0]].squads += parseInt(cols[3]) || 0;
                        units[cols[0]].houses += parseInt(cols[4]) || 0;
                    }
                });

                rawUnits = units;
                const select = document.getElementById('pan-filter');
                Array.from(uniquePanchayats).sort().forEach(p => {
                    let opt = document.createElement('option');
                    opt.value = p; opt.innerText = p;
                    select.appendChild(opt);
                });

                updateUI();
                updateCountdown();
            } catch (e) { console.error(e); }
        }

        function updateCountdown() {
            const endDate = new Date("2026-02-15");
            const diff = Math.ceil((endDate - new Date()) / (1000 * 60 * 60 * 24));
            document.getElementById('countdown-timer').innerText = diff > 0 ? `‚è≥ ‡¥´‡µÜ‡¥¨‡µç‡¥∞‡µÅ‡¥µ‡¥∞‡¥ø 15 ‡¥≤‡¥ï‡µç‡¥∑‡µç‡¥Ø‡¥§‡µç‡¥§‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥á‡¥®‡¥ø ${diff} ‡¥¶‡¥ø‡¥µ‡¥∏‡¥ô‡µç‡¥ô‡µæ` : `üèÅ ‡¥∏‡¥Æ‡¥Ø‡¥Ç ‡¥Ö‡¥µ‡¥∏‡¥æ‡¥®‡¥ø‡¥ö‡µç‡¥ö‡µÅ`;
        }

        function updateUI() {
            const pan = document.getElementById('pan-filter').value;
            const sortMode = document.getElementById('sort-filter').value;
            let units = Object.values(rawUnits);
            if (pan !== 'all') units = units.filter(u => u.panchayath === pan);

            const totalTarget = units.reduce((a, b) => a + b.target, 0);
            const totalColl = units.reduce((a, b) => a + b.coll, 0);
            const overallPerc = totalTarget > 0 ? ((totalColl/totalTarget)*100).toFixed(1) : 0;

            document.getElementById('total-collected').innerText = '‚Çπ ' + totalColl.toLocaleString('en-IN');
            document.getElementById('total-target').innerText = '‚Çπ ' + totalTarget.toLocaleString('en-IN');
            document.getElementById('main-progress').style.width = Math.min(overallPerc, 100) + '%';
            document.getElementById('stats-title').innerText = pan === 'all' ? "‡¥Æ‡µä‡¥§‡µç‡¥§‡¥§‡µç‡¥§‡¥ø‡¥≤‡µÅ‡¥≥‡µç‡¥≥ ‡¥™‡µÅ‡¥∞‡µã‡¥ó‡¥§‡¥ø" : `${pan} ‡¥™‡¥û‡µç‡¥ö‡¥æ‡¥Ø‡¥§‡µç‡¥§‡µç ‡¥™‡µÅ‡¥∞‡µã‡¥ó‡¥§‡¥ø`;

            const zeroUnits = units.filter(u => u.coll === 0);
            const achievers = units.filter(u => u.target > 0 && (u.coll >= u.target));

            // --- RANKING LOGIC START (Metal Colors) ---
            const rankedUnits = [...units].sort((a, b) => {
                const percA = a.target > 0 ? (a.coll / a.target) : 0;
                const percB = b.target > 0 ? (b.coll / b.target) : 0;
                return percB - percA;
            }).slice(0, 3);

            const rankContainer = document.getElementById('ranking-container');
            
            // ‡¥∏‡µç‡¥µ‡µº‡¥£‡µç‡¥£‡¥Ç, ‡¥µ‡µÜ‡¥≥‡µç‡¥≥‡¥ø, ‡¥µ‡µÜ‡¥ô‡µç‡¥ï‡¥≤‡¥Ç ‡¥®‡¥ø‡¥±‡¥ô‡µç‡¥ô‡µæ‡¥ï‡µç‡¥ï‡¥æ‡¥Ø‡µÅ‡¥≥‡µç‡¥≥ ‡¥∏‡µç‡¥±‡µç‡¥±‡µà‡¥≤‡µÅ‡¥ï‡µæ
            const rankStyles = [
                { border: 'border-yellow-500', bg: 'bg-yellow-50', text: 'text-yellow-700', icon: 'ü•á', label: 'GOLD' },   // Rank 1: Gold
                { border: 'border-slate-400', bg: 'bg-slate-50', text: 'text-slate-600', icon: 'ü•à', label: 'SILVER' },  // Rank 2: Silver
                { border: 'border-orange-700', bg: 'bg-orange-50', text: 'text-orange-800', icon: 'ü•â', label: 'BRONZE' } // Rank 3: Bronze
            ];

            rankContainer.innerHTML = rankedUnits.map((u, index) => {
                const p = u.target > 0 ? ((u.coll / u.target) * 100).toFixed(1) : 0;
                const style = rankStyles[index];
                
                return `
                    <div class="${style.bg} p-2 md:p-4 rounded-2xl shadow-lg border-b-4 ${style.border} relative transition-all duration-300">
                        <div class="flex flex-col items-center text-center">
                            <span class="text-2xl md:text-3xl drop-shadow-sm">${style.icon}</span>
                            <p class="text-[7px] font-black text-gray-400 mt-1 uppercase tracking-tighter">${style.label}</p>
                            <h3 class="font-black text-gray-800 text-[10px] md:text-xs truncate w-full uppercase mt-0.5">${u.name}</h3>
                            <div class="font-black ${style.text} text-sm md:text-xl mt-1">${p}%</div>
                            <div class="text-[8px] font-bold text-gray-500 italic">‚Çπ${u.coll.toLocaleString()}</div>
                        </div>
                    </div>
                `;
            }).join('');
            // --- RANKING LOGIC END ---

            renderZeroBadges(zeroUnits);
            generateAchieverAI(achievers);
            renderUnitList(units, sortMode);
            renderChart(units, sortMode); 
            generateOverallAI(pan, units, overallPerc, totalTarget - totalColl, zeroUnits);
        }

        function renderZeroBadges(units) {
            const container = document.getElementById('zero-container');
            const list = document.getElementById('zero-badge-list');
            if (units.length === 0) { container.classList.add('hidden'); return; }
            container.classList.remove('hidden');
            list.innerHTML = units.map(u => `<span class="bg-white/20 border border-white/40 text-white text-[10px] font-black px-3 py-1.5 rounded-full shadow-sm">‚ö†Ô∏è ${u.name}</span>`).join('');
        }

        function generateAchieverAI(achievers) {
            const container = document.getElementById('achiever-container');
            const content = document.getElementById('achiever-ai-content');
            if (achievers.length === 0) { container.classList.add('hidden'); return; }
            container.classList.remove('hidden');
            
            const names = achievers.map(a => a.name).join(', ');
            const totalHouses = achievers.reduce((a,b) => a + b.houses, 0);
            const totalSquads = achievers.reduce((a,b) => a + b.squads, 0);
            
            const templates = [
                `üåü <b>‡¥Ö‡¥§‡¥ø‡¥∂‡¥Ø‡¥ï‡¥∞‡¥Æ‡¥æ‡¥Ø ‡¥Æ‡µÅ‡¥®‡µç‡¥®‡µá‡¥±‡µç‡¥±‡¥Ç!</b> ‡¥≤‡¥ï‡µç‡¥∑‡µç‡¥Ø‡¥Ç 100% ‡¥™‡µÇ‡µº‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥æ‡¥ï‡µç‡¥ï‡¥ø‡¥Ø <b>${achievers.length}</b> ‡¥Ø‡µÇ‡¥£‡¥ø‡¥±‡µç‡¥±‡µÅ‡¥ï‡µæ‡¥ï‡µç‡¥ï‡µç ‡¥π‡µÉ‡¥¶‡¥Ø‡¥™‡µÇ‡µº‡¥µ‡µç‡¥µ‡¥Ç ‡¥±‡µÜ‡¥°‡µç ‡¥∏‡¥≤‡µç‡¥Ø‡µÇ‡¥ü‡µç‡¥ü‡µç! <b>${names}</b> ‡¥Ø‡µÇ‡¥£‡¥ø‡¥±‡µç‡¥±‡µÅ‡¥ï‡µæ ‡¥á‡¥§‡¥ø‡¥®‡¥ï‡¥Ç <b>${totalHouses}</b> ‡¥µ‡µÄ‡¥ü‡µÅ‡¥ï‡¥≥‡¥ø‡µΩ ‡¥∏‡¥®‡µç‡¥¶‡µá‡¥∂‡¥Æ‡µÜ‡¥§‡µç‡¥§‡¥ø‡¥ö‡µç‡¥ö‡µÅ.`,
                `üèÜ <b>‡¥µ‡¥ø‡¥ú‡¥Ø‡¥ó‡¥æ‡¥• ‡¥§‡µÅ‡¥ü‡¥∞‡µÅ‡¥®‡µç‡¥®‡µÅ!</b> ‡¥®‡¥ø‡¥∂‡µç‡¥ö‡¥Ø‡¥ø‡¥ö‡µç‡¥ö ‡¥ü‡¥æ‡µº‡¥ó‡µÜ‡¥±‡µç‡¥±‡µç ‡¥Æ‡¥±‡¥ø‡¥ï‡¥ü‡¥®‡µç‡¥® <b>${names}</b> ‡¥Ø‡µÇ‡¥£‡¥ø‡¥±‡µç‡¥±‡µÅ‡¥ï‡¥≥‡µÅ‡¥ü‡µÜ ‡¥Ü‡¥µ‡µá‡¥∂‡¥Ç ‡¥Æ‡¥æ‡¥§‡µÉ‡¥ï‡¥æ‡¥™‡¥∞‡¥Æ‡¥æ‡¥£‡µç. ‡¥á‡¥µ‡µº <b>${totalSquads}</b> ‡¥∏‡µç‡¥ï‡µç‡¥µ‡¥æ‡¥°‡µÅ‡¥ï‡¥≥‡µÜ ‡¥∏‡¥ú‡µÄ‡¥µ‡¥Æ‡¥æ‡¥Ø‡¥ø ‡¥∞‡¥Ç‡¥ó‡¥§‡µç‡¥§‡¥ø‡¥±‡¥ï‡µç‡¥ï‡¥ø ‡¥à ‡¥®‡µá‡¥ü‡µç‡¥ü‡¥Ç ‡¥ï‡µà‡¥µ‡¥∞‡¥ø‡¥ö‡µç‡¥ö‡µÅ.`,
                `‚ú® <b>‡¥™‡µã‡¥∞‡¥æ‡¥ü‡µç‡¥ü‡¥µ‡µÄ‡¥∞‡µç‡¥Ø‡¥Ç!</b> <b>${achievers.length}</b> ‡¥Ø‡µÇ‡¥£‡¥ø‡¥±‡µç‡¥±‡µÅ‡¥ï‡µæ ‡¥á‡¥§‡¥ø‡¥®‡¥ï‡¥Ç ‡¥§‡¥®‡µç‡¥®‡µÜ ‡¥µ‡¥ø‡¥ú‡¥Ø‡¥ï‡µç‡¥ï‡µä‡¥ü‡¥ø ‡¥™‡¥æ‡¥±‡¥ø‡¥ö‡µç‡¥ö‡µÅ. <b>${names}</b> ‡¥Ø‡µÇ‡¥£‡¥ø‡¥±‡µç‡¥±‡µÅ‡¥ï‡µæ ‡¥ï‡¥æ‡¥£‡¥ø‡¥ö‡µç‡¥ö ‡¥à ‡¥ï‡µÉ‡¥§‡µç‡¥Ø‡¥®‡¥ø‡¥∑‡µç‡¥†‡¥Ø‡µÅ‡¥Ç ‡¥µ‡µá‡¥ó‡¥§‡¥Ø‡µÅ‡¥Ç ‡¥Æ‡¥£‡µç‡¥°‡¥≤‡¥§‡µç‡¥§‡¥ø‡¥®‡µç ‡¥µ‡¥≤‡¥ø‡¥Ø ‡¥ä‡µº‡¥ú‡µç‡¥ú‡¥Æ‡¥æ‡¥£‡µç ‡¥®‡µΩ‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡µç.`
            ];
            content.innerHTML = templates[Math.floor(Math.random() * templates.length)];
        }

        function generateOverallAI(pan, units, perc, rem, zeros) {
            const content = document.getElementById('ai-dynamic-content');
            const topUnit = [...units].sort((a,b) => b.coll - a.coll)[0];
            const daysLeft = Math.max(1, Math.ceil((new Date("2026-02-10") - new Date()) / (1000 * 60 * 60 * 24)));
            const dailyReq = Math.round(rem / daysLeft);

            const templates = [
                `<p>‡¥Æ‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥±‡¥Ç ‡¥Æ‡¥£‡µç‡¥°‡¥≤‡¥Ç ‡¥®‡¥ø‡¥≤‡¥µ‡¥ø‡µΩ <b>${perc}%</b> ‡¥≤‡¥ï‡µç‡¥∑‡µç‡¥Ø‡¥Ç ‡¥™‡µÇ‡µº‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥æ‡¥ï‡µç‡¥ï‡¥ø. <b>${topUnit.name}</b> ‡¥Ü‡¥£‡µç ‡¥®‡¥ø‡¥≤‡¥µ‡¥ø‡µΩ ‡¥Æ‡µÅ‡¥®‡µç‡¥®‡¥ø‡µΩ ‡¥®‡¥ø‡µΩ‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡µç. ‡¥´‡µÜ‡¥¨‡µç‡¥∞‡µÅ‡¥µ‡¥∞‡¥ø 15 ‡¥≤‡¥ï‡µç‡¥∑‡µç‡¥Ø‡¥§‡µç‡¥§‡¥ø‡¥≤‡µÜ‡¥§‡µç‡¥§‡¥æ‡µª ‡¥á‡¥®‡¥ø <b>‚Çπ${dailyReq.toLocaleString()}</b> ‡¥µ‡µÄ‡¥§‡¥Ç ‡¥®‡¥æ‡¥Ç ‡¥¶‡¥ø‡¥µ‡¥∏‡µá‡¥® ‡¥∏‡¥Æ‡¥æ‡¥π‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µá‡¥£‡µç‡¥ü‡¥§‡µÅ‡¥£‡µç‡¥ü‡µç. 0% ‡¥®‡¥ø‡µΩ‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥® ${zeros.length} ‡¥Ø‡µÇ‡¥£‡¥ø‡¥±‡µç‡¥±‡µÅ‡¥ï‡µæ ‡¥â‡¥ü‡µª ‡¥∏‡¥ú‡µÄ‡¥µ‡¥Æ‡¥æ‡¥ï‡¥£‡¥Ç.</p>`,
                `<p><b>‡¥Ö‡¥µ‡¥∏‡¥æ‡¥® ‡¥®‡¥ø‡¥Æ‡¥ø‡¥∑‡¥Ç ‡¥Ö‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ!</b> ‡¥á‡¥®‡¥ø ‡¥∏‡¥Æ‡¥æ‡¥π‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥®‡µÅ‡¥≥‡µç‡¥≥‡¥§‡µç ‚Çπ${rem.toLocaleString()} ‡¥Ü‡¥£‡µç. ‡¥®‡¥æ‡¥Ç ‡¥á‡¥™‡µç‡¥™‡µã‡µæ <b>${perc}%</b> ‡¥®‡µá‡¥ü‡µç‡¥ü‡¥§‡µç‡¥§‡¥ø‡¥≤‡¥æ‡¥£‡µç. <b>${topUnit.name}</b> ‡¥Ø‡µÇ‡¥£‡¥ø‡¥±‡µç‡¥±‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥Ö‡¥§‡µá ‡¥µ‡µá‡¥ó‡¥§ ‡¥Æ‡¥±‡µç‡¥±‡µÅ‡¥≥‡µç‡¥≥‡¥µ‡¥∞‡¥ø‡¥≤‡µÅ‡¥Ç ‡¥Ü‡¥µ‡¥∂‡µç‡¥Ø‡¥Æ‡¥æ‡¥£‡µç. ‡¥¶‡¥ø‡¥µ‡¥∏‡µá‡¥®‡¥Ø‡µÅ‡¥≥‡µç‡¥≥ ‡¥∏‡¥Æ‡¥æ‡¥π‡¥∞‡¥£ ‡¥≤‡¥ï‡µç‡¥∑‡µç‡¥Ø‡¥Ç <b>‚Çπ${dailyReq.toLocaleString()}</b> ‡¥Ü‡¥Ø‡¥ø ‡¥®‡¥ø‡¥∂‡µç‡¥ö‡¥Ø‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.</p>`,
                `<p>‡¥Æ‡¥ø‡¥ï‡¥ö‡µç‡¥ö ‡¥™‡µÅ‡¥∞‡µã‡¥ó‡¥§‡¥ø‡¥Ø‡¥æ‡¥£‡µç ‡¥®‡¥æ‡¥Ç ‡¥ï‡¥æ‡¥¥‡µç‡¥ö‡¥µ‡µÜ‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡µç, ‡¥á‡¥§‡¥ø‡¥®‡µã‡¥ü‡¥ï‡¥Ç <b>${perc}%</b> ‡¥™‡µÇ‡µº‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥æ‡¥Ø‡¥ø. ‡¥á‡¥®‡¥ø ‡¥Æ‡µÅ‡¥®‡µç‡¥®‡¥ø‡¥≤‡µÅ‡¥≥‡µç‡¥≥‡¥§‡µç ${daysLeft} ‡¥¶‡¥ø‡¥µ‡¥∏‡¥ô‡µç‡¥ô‡µæ ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Æ‡¥æ‡¥£‡µç. 0% ‡¥®‡¥ø‡µΩ‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥® ‡¥Ø‡µÇ‡¥£‡¥ø‡¥±‡µç‡¥±‡µÅ‡¥ï‡µæ ‡¥Ö‡¥ü‡¥ø‡¥Ø‡¥®‡µç‡¥§‡¥∞‡¥Æ‡¥æ‡¥Ø‡¥ø ‡¥∏‡µç‡¥ï‡µç‡¥µ‡¥æ‡¥°‡µÅ‡¥ï‡µæ ‡¥∞‡µÇ‡¥™‡µÄ‡¥ï‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï. ‡¥ì‡¥∞‡µã ‡¥¶‡¥ø‡¥µ‡¥∏‡¥µ‡µÅ‡¥Ç <b>‚Çπ${dailyReq.toLocaleString()}</b> ‡¥∏‡¥Æ‡¥æ‡¥π‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡µª ‡¥®‡¥æ‡¥Ç ‡¥∂‡µç‡¥∞‡¥¶‡µç‡¥ß ‡¥ï‡µá‡¥®‡µç‡¥¶‡µç‡¥∞‡µÄ‡¥ï‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡¥£‡¥Ç.</p>`
            ];

            content.innerHTML = templates[Math.floor(Math.random() * templates.length)];
        }

        function renderUnitList(units, sortMode) {
            const container = document.getElementById('unit-list-container');
            const sorted = [...units].sort((a,b) => {
                if (sortMode === 'percent') return (b.coll/b.target) - (a.coll/a.target);
                return b.coll - a.coll;
            });
            
            const daysLeft = Math.max(1, Math.ceil((new Date("2026-02-15") - new Date()) / (1000 * 60 * 60 * 24)));

            container.innerHTML = sorted.map(u => {
                const p = u.target > 0 ? ((u.coll/u.target)*100).toFixed(1) : 0;
                const r = u.target - u.coll;
                const d = r > 0 ? Math.round(r / daysLeft) : 0;

                let aiClass = "";
                let aiMsg = "";

                if (p == 0) {
                    aiClass = "zero-perf glow-red";
                    aiMsg = `üõë <b>‡¥Æ‡µÅ‡¥®‡µç‡¥®‡¥±‡¥ø‡¥Ø‡¥ø‡¥™‡µç‡¥™‡µç:</b> ‡¥í‡¥ü‡µç‡¥ü‡µÅ‡¥Ç ‡¥ï‡¥≥‡¥ï‡µç‡¥∑‡µª ‡¥§‡µÅ‡¥ü‡¥ô‡µç‡¥ô‡¥ø‡¥Ø‡¥ø‡¥ü‡µç‡¥ü‡¥ø‡¥≤‡µç‡¥≤! ‡¥´‡µÜ‡¥¨‡µç‡¥∞‡µÅ‡¥µ‡¥∞‡¥ø 15-‡¥®‡¥ï‡¥Ç ‡¥§‡µÄ‡µº‡¥ï‡µç‡¥ï‡¥æ‡µª ‡¥¶‡¥ø‡¥µ‡¥∏‡µá‡¥® ‚Çπ${d.toLocaleString()} ‡¥µ‡µÄ‡¥§‡¥Ç ‡¥™‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡¥£‡¥Ç.`;
                } else if (p >= 100) {
                    aiClass = "success-perf";
                    aiMsg = `üèÜ <b>‡¥Ö‡¥≠‡¥ø‡¥®‡¥®‡µç‡¥¶‡¥®‡¥ô‡µç‡¥ô‡µæ!</b> ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ ‡¥≤‡¥ï‡µç‡¥∑‡µç‡¥Ø‡¥Ç 100% ‡¥™‡µÇ‡µº‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥æ‡¥ï‡µç‡¥ï‡¥ø. ‡¥Æ‡¥æ‡¥§‡µÉ‡¥ï‡¥æ‡¥™‡¥∞‡¥Æ‡¥æ‡¥Ø ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥®‡¥Ç.`;
                } else if (p < 40) {
                    aiClass = "warning-perf";
                    aiMsg = `‚ö° <b>‡¥µ‡µá‡¥ó‡¥§ ‡¥ï‡µÇ‡¥ü‡µç‡¥ü‡µÅ‡¥ï:</b> ‡¥á‡¥§‡µÅ‡¥µ‡¥∞‡µÜ ${p}% ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Æ‡µá ‡¥Ü‡¥Ø‡¥ø‡¥ü‡µç‡¥ü‡µÅ‡¥≥‡µç‡¥≥‡µÇ. ‡¥¶‡¥ø‡¥µ‡¥∏‡µá‡¥® ‚Çπ${d.toLocaleString()} ‡¥µ‡µÄ‡¥§‡¥Ç ‡¥∏‡¥Æ‡¥æ‡¥π‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡µª ‡¥∂‡µç‡¥∞‡¥¶‡µç‡¥ß‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.`;
                } else {
                    aiClass = "success-perf bg-blue-50 border-blue-200 text-blue-900";
                    aiMsg = `‚úÖ <b>‡¥®‡¥≤‡µç‡¥≤ ‡¥Æ‡µÅ‡¥®‡µç‡¥®‡µá‡¥±‡µç‡¥±‡¥Ç:</b> ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ ${p}% ‡¥≤‡¥ï‡µç‡¥∑‡µç‡¥Ø‡¥Ç ‡¥ï‡µà‡¥µ‡¥∞‡¥ø‡¥ö‡µç‡¥ö‡µÅ. ‡¥¨‡¥æ‡¥ï‡µç‡¥ï‡¥ø ‚Çπ${r.toLocaleString()} ‡¥§‡µÄ‡µº‡¥ï‡µç‡¥ï‡¥æ‡µª ‡¥∏‡µç‡¥ï‡µç‡¥µ‡¥æ‡¥°‡µç ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥®‡¥Ç ‡¥§‡µÅ‡¥ü‡¥∞‡µÅ‡¥ï.`;
                }

                return `
                    <div class="p-5 bg-white">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="font-black text-gray-800 text-sm uppercase tracking-tight">${u.name}</h4>
                                <div class="text-blue-700 font-black text-2xl tracking-tighter mt-1">‚Çπ${u.coll.toLocaleString()}</div>
                            </div>
                            <div class="text-right">
                                <div class="font-black text-2xl ${p < 40 ? 'text-red-600' : 'text-green-600'}">${p}%</div>
                                <div class="text-[9px] font-bold text-gray-400 mt-1 uppercase">‡¥≤‡¥ï‡µç‡¥∑‡µç‡¥Ø‡¥Ç: ‚Çπ${u.target.toLocaleString()}</div>
                            </div>
                        </div>
                        <div class="flex gap-4 text-[9px] font-bold text-gray-500 mb-2 uppercase italic border-b border-dashed pb-2">
                            <span>üë• ${u.squads} ‡¥∏‡µç‡¥ï‡µç‡¥µ‡¥æ‡¥°‡µç</span>
                            <span>üè† ${u.houses} ‡¥µ‡µÄ‡¥ü‡µç</span>
                        </div>
                        <div class="ai-status-box ${aiClass}">${aiMsg}</div>
                    </div>
                `;
            }).join('');
        }

        function renderChart(units, mode) {
    const ctx = document.getElementById('performanceChart').getContext('2d');
    
    // ‡¥ü‡¥æ‡µº‡¥ó‡µÜ‡¥±‡µç‡¥±‡µç % ‡¥Ü‡¥£‡µã ‡¥Ö‡¥§‡µã ‡¥§‡µÅ‡¥ï‡¥Ø‡¥æ‡¥£‡µã ‡¥é‡¥®‡µç‡¥®‡µç ‡¥®‡µã‡¥ï‡µç‡¥ï‡¥ø ‡¥°‡¥æ‡¥±‡µç‡¥± ‡¥∏‡µã‡µº‡¥ü‡µç‡¥ü‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ
    const sortedData = [...units].sort((a, b) => {
        if (mode === 'percent') {
            const percA = a.target > 0 ? (a.coll / a.target) : 0;
            const percB = b.target > 0 ? (b.coll / b.target) : 0;
            return percB - percA; // ‡¥∂‡¥§‡¥Æ‡¥æ‡¥®‡¥§‡µç‡¥§‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥Ö‡¥ü‡¥ø‡¥∏‡µç‡¥•‡¥æ‡¥®‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥è‡¥±‡µç‡¥±‡¥µ‡µÅ‡¥Ç ‡¥â‡¥Ø‡µº‡¥®‡µç‡¥®‡¥§‡µç ‡¥Ü‡¥¶‡µç‡¥Ø‡¥Ç
        }
        return b.coll - a.coll; // ‡¥§‡µÅ‡¥ï‡¥Ø‡µÅ‡¥ü‡µÜ ‡¥Ö‡¥ü‡¥ø‡¥∏‡µç‡¥•‡¥æ‡¥®‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥è‡¥±‡µç‡¥±‡¥µ‡µÅ‡¥Ç ‡¥â‡¥Ø‡µº‡¥®‡µç‡¥®‡¥§‡µç ‡¥Ü‡¥¶‡µç‡¥Ø‡¥Ç
    }).slice(0, 15); // ‡¥Æ‡¥ø‡¥ï‡¥ö‡µç‡¥ö 10 ‡¥Ø‡µÇ‡¥£‡¥ø‡¥±‡µç‡¥±‡µÅ‡¥ï‡µæ ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Ç ‡¥ï‡¥æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡µª

    if (myChart) myChart.destroy();
    myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: sortedData.map(u => u.name),
            datasets: [{
                label: mode === 'amount' ? '‡¥∏‡¥Æ‡¥æ‡¥π‡¥∞‡¥ø‡¥ö‡µç‡¥ö‡¥§‡µç (‚Çπ)' : '‡¥™‡µÇ‡µº‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥æ‡¥Ø‡¥§‡µç (%)',
                data: sortedData.map(u => mode === 'amount' ? u.coll : ((u.coll / u.target) * 100).toFixed(1)),
                backgroundColor: mode === 'amount' ? '#10b981' : '#1e40af',
                borderRadius: 8
            }]
        },
        options: { 
            responsive: true, 
            maintainAspectRatio: false, 
            plugins: { legend: { display: false } },
            scales: { 
                y: { 
                    beginAtZero: true, 
                    // ‡¥∂‡¥§‡¥Æ‡¥æ‡¥®‡¥Æ‡¥æ‡¥£‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Ç Y-Axis ‡¥™‡¥∞‡¥Æ‡¥æ‡¥µ‡¥ß‡¥ø 100 ‡¥Ü‡¥Ø‡¥ø ‡¥®‡¥ø‡¥ú‡¥™‡µç‡¥™‡µÜ‡¥ü‡µÅ‡¥§‡µç‡¥§‡µÅ‡¥®‡µç‡¥®‡µÅ
                    max: mode === 'percent' ? 100 : undefined, 
                    grid: { color: '#f3f4f6' } 
                },
                x: { grid: { display: false } }
            }
        }
    });
}

    </script>
</body>
</html>




